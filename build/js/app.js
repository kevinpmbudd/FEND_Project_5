"use strict";var map,infowindow,markers=[],locations=[{lat:33.992004,lng:-118.470488,title:"Blue Bottle Coffee - Abbot Kinney",yelpID:"blue-bottle-los-angeles-3",yelpRatingImg:null,yelpRating:null,yelpReviewCount:null,marker:null},{lat:34.038812,lng:-118.232656,title:"Blue Bottle Coffee - Arts District",yelpID:"blue-bottle-coffee-los-angeles-12",yelpRatingImg:null,yelpRating:null,yelpReviewCount:null,marker:null},{lat:34.076009,lng:-118.370111,title:"Blue Bottle Coffee - Beverly Grove Cafe",yelpID:"blue-bottle-coffee-los-angeles-14",yelpRatingImg:null,yelpRating:null,yelpReviewCount:null,marker:null},{lat:33.99811,lng:-118.479512,title:"Espresso Cielo",yelpID:"espresso-cielo-santa-monica",yelpRatingImg:null,yelpRating:null,yelpReviewCount:null,marker:null},{lat:34.078993,lng:-118.309309,title:"LaB - Coffee and Roasters",yelpID:"lab-coffee-and-roasters-los-angeles",yelpRatingImg:null,yelpRating:null,yelpReviewCount:null,marker:null},{lat:34.145864,lng:-118.151678,title:"Intelligentsia - Pasadena",yelpID:"intelligentsia-coffee-pasadena",yelpRatingImg:null,yelpRating:null,yelpReviewCount:null,marker:null},{lat:34.091966,lng:-118.279965,title:"Intelligentsia - Silverlake",yelpID:"intelligentsia-coffee-los-angeles-4",yelpRatingImg:null,yelpRating:null,yelpReviewCount:null,marker:null},{lat:33.991111,lng:-118.466812,title:"Intelligentsia - Venice",yelpID:"intelligentsia-coffee-venice",yelpRatingImg:null,yelpRating:null,yelpReviewCount:null,marker:null}],initMap=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:34.07,lng:-118.3},zoom:11,mapTypeId:google.maps.MapTypeId.TERRAIN}),infowindow=new google.maps.InfoWindow},initMarker=function(e){var l="<div>"+e.title+'<br> Yelp Rating: <img src="'+e.yelpRatingImg+'"><br>'+e.yelpRating+" stars<br>Number of Reviews: "+e.yelpReviewCount+"</div>",n=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:map,title:e.title,animation:google.maps.Animation.DROP,visible:!0});n.addListener("click",function(){infowindow.setContent(l),infowindow.open(n.get("map"),n),n.setAnimation(google.maps.Animation.DROP)}),e.marker=n,markers.push(n)},yelp=function(e){function l(){return Math.floor(1e12*Math.random()).toString()}var n="Q9ytXgv7OcR2aC2HYDsGPg",t="MlUPkhWTf-2ar9ZWhnNlRb1PDZg",a="KdkGSp3vHhxzajyR2sNfkpY15m53MaSV",i="fUufpxoSWMiwutlBmKs9x5_ck8o",o="https://api.yelp.com/v2/business/",r=o+e.yelpID,u={oauth_consumer_key:n,oauth_token:a,oauth_nonce:l(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},s=oauthSignature.generate("GET",r,u,t,i);u.oauth_signature=s;var g={url:r,data:u,cache:!0,dataType:"jsonp"};$.ajax(g).done(function(l){e.yelpRating=l.rating,e.yelpReviewCount=l.review_count,e.yelpRatingImg=l.rating_img_url,initMarker(e)}).fail(function(){e.yelpRating="Yelp rating not currently available",e.yelpReviewCount="Review count not currently available",e.yelpRatingImg="./img/coffee.png",initMarker(e)})},setVisibilty=function(e){for(var l=0;l<markers.length;l++)for(var n=0;n<e.length;n++){var t=e[n];if(t.title===markers[l].title){markers[l].setVisible(!0);break}markers[l].setVisible(!1)}},ViewModel=function(){var e=this;e.locationList=ko.observableArray(locations),e.query=ko.observable(""),e.search=ko.computed(function(){return ko.utils.arrayFilter(e.locationList(),function(l){return l.title.toLowerCase().indexOf(e.query().toLowerCase())>=0})}),e.search.subscribe(function(){setVisibilty(e.search())}),this.listviewClick=function(e){e.marker.setAnimation(google.maps.Animation.DROP),google.maps.event.trigger(e.marker,"click")}},loadYelp=function(){locations.forEach(function(e){yelp(e)})};ko.applyBindings(new ViewModel),$(document).ready(function(){loadYelp()});